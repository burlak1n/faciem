### **План Разработки Backend: Пошаговый TODO-Лист**  

---

#### **Этап 0: Подготовка (Setup)**  
- [ ] Определить зависимости: `FastAPI`, `RetinaFace`, `FaceNet512`, `Milvus`, `SQLAlchemy`, `Loguru`.  
- [ ] Выбрать брокер сообщений для FastStream (например, Redis).  
- [x] Настроить структуру проекта

---

#### **Этап 1: MVP (Минимальный Рабочий Продукт)**  
*Цель: Реализовать базовую функциональность для поиска лиц из локальной директории.*  

##### **1.1 Загрузка фото из локальной директории**  
- [ ] Реализовать сканирование указанной директории с поддержкой JPG/PNG/WEBP.  
- [ ] Добавить API-эндпоинт для указания пути к папке (`POST /upload/local`).  
- [ ] Логировать список загруженных файлов.  

##### **1.2 Поиск лиц (Face Detection)**  
- [ ] Интегрировать RetinaFace для детекции лиц.  
- [ ] Сохранять координаты bounding boxes и качество обнаружения.  
- [ ] Исключать фото без лиц (сохранять в отдельную категорию).  

##### **1.3 Генерация эмбеддингов**  
- [ ] Использовать FaceNet512 для создания векторных представлений лиц.  
- [ ] Сохранять эмбеддинги в формате `numpy array`.  

##### **1.4 Хранение в Milvus**  
- [ ] Настроить локальный инстанс Milvus Lite.  
- [ ] Сохранять эмбеддинги с метаданными (ID фото, координаты лица).  
- [ ] Реализовать поиск по вектору (Top-K Nearest Neighbors).  

##### **1.5 Поиск по образцу (API)**  
- [ ] Создать API-эндпоинт для загрузки образца (`POST /search/upload`).  
- [ ] Обрабатывать образец (детекция → эмбеддинг → поиск в Milvus).  
- [ ] Возвращать список найденных лиц с координатами и ID фото.  

##### **1.7 Тестирование MVP**  
- [ ] Проверить корректность загрузки фото.  
- [ ] Протестировать поиск по образцу на тестовых данных.  
- [ ] Убедиться, что фото без лиц исключаются.  

---

#### **Этап 2: Расширение Функционала**  
*Цель: Добавить интеграцию с ВК/Яндекс.Диском, кластеризацию и улучшения API.*  

##### **2.1 Интеграция с ВКонтакте**  
- [ ] Реализовать авторизацию через OAuth.  
- [ ] Получать список альбомов и фото по API.  
- [ ] Добавить автоматическую загрузку фото (фоновая задача через FastStream).  

##### **2.2 Интеграция с Яндекс.Диском**  
- [ ] Использовать Yandex API для скачивания файлов по ссылке.  
- [ ] Поддержка папок и вложенных структур.  

##### **2.3 Кластеризация лиц**  
- [ ] Реализовать DBSCAN/K-Means для группировки схожих лиц.  
- [ ] Добавить API-эндпоинты для работы с кластерами.  

##### **2.5 Асинхронная обработка (FastStream)**  
- [ ] Перенести обработку фото в фоновые задачи через FastStream.  
- [ ] Интегрировать Redis как брокер сообщений.  

---

#### **Этап 3: Оптимизация и Масштабируемость**  
*Цель: Повысить производительность и готовность к продакшену.*  

##### **3.1 Переход на PostgreSQL**  
- [ ] Заменить SQLite на PostgreSQL с использованием SQLAlchemy.  
- [ ] Перенести метаданные (ID фото, координаты, источники).  

##### **3.2 GPU-ускорение**  
- [ ] Настроить CUDA для FaceNet/ArcFace.  
- [ ] Тестировать производительность на GPU vs CPU.  

##### **3.3 Мониторинг и логирование**  
- [x] Интегрировать Prometheus для сбора метрик (скорость обработки, время отклика).  
- [ ] Визуализировать графики через Grafana.  
- [x] Логировать ошибки и статусы задач (Loguru).  

##### **3.4 Безопасность**  
- [ ] Добавить аутентификацию пользователей (JWT).  
- [ ] Защитить API ключами для интеграции с внешними сервисами.  

---

#### **Этап 4: Тестирование и Документация**  
*Цель: Убедиться в стабильности и удобстве использования.*  

##### **4.1 Тестирование**  
- [ ] Написать unit-тесты для всех модулей (pytest).  
- [ ] Провести нагрузочное тестирование (10k фото).  
- [ ] Проверить точность моделей на эталонных датасетах (LFW).  

##### **4.2 Документация**  
- [ ] Создать API-документацию (Swagger/OpenAPI).  
- [ ] Добавить инструкции по установке и настройке.  
- [ ] Описать схему базы данных и API-эндпоинты.  

##### **4.3 Деплой**  
- [ ] Настроить Docker-образ для backend.  
- [ ] Развернуть систему на облачном сервере (например, AWS/GCP).  
- [ ] Настроить CI/CD через GitHub Actions.  

---

#### **Этап 5: Дальнейшее Развитие**  
*Цель: Добавить продвинутые функции по запросам пользователей.*  
- [ ] Интеграция Google Photos/Dropbox.  
- [ ] Поддержка видеофайлов (кадрирование и анализ лиц).  
- [ ] Нейросетевой редактор фото (удаление лиц, размытие).  

---

### **Критерии Успеха MVP**  
- Backend должен обеспечивать:  
  1. Загрузку фото из локальной директории через API.  
  2. Детекцию лиц и сохранение их эмбеддингов.  
  3. Поиск похожих лиц по образцу.  
  4. Исключение фото без лиц из обработки.  
  5. Стабильную работу API с минимальной задержкой. 